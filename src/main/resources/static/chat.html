<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç®€å•èŠå¤©ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #chat-messages {
            height: 400px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: scroll;
            background-color: #fafafa;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            background-color: #e3f2fd;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .input-group button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .input-group button:hover {
            background-color: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.connected {
            background-color: #d4edda;
            color: #155724;
        }
        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        .group-controls {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ç®€åŒ–ç‰ˆå®æ—¶èŠå¤©ç³»ç»Ÿ</h1>
        
        <div id="status" class="status disconnected">æœªè¿æ¥</div>
        
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="input-group">
            <input type="number" id="student-id" placeholder="å­¦ç”ŸID" value="1">
            <input type="text" id="student-name" placeholder="å­¦ç”Ÿå§“å" value="å¼ ä¸‰">
            <button onclick="connect()">è¿æ¥</button>
            <button onclick="disconnect()">æ–­å¼€</button>
        </div>
        
        <!-- ç¾¤ç»„æ§åˆ¶ -->
        <div class="group-controls">
            <h3>ç¾¤ç»„ç®¡ç†</h3>
            <div class="input-group">
                <input type="text" id="group-id" placeholder="ç¾¤ç»„ID" value="group_123">
                <button onclick="joinGroup()">åŠ å…¥ç¾¤ç»„</button>
                <button onclick="leaveGroup()">ç¦»å¼€ç¾¤ç»„</button>
            </div>
        </div>
        
        <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ -->
        <div id="chat-messages"></div>
        
        <!-- å‘é€æ¶ˆæ¯ -->
        <div class="input-group">
            <input type="number" id="target-id" placeholder="ç§èŠå¯¹è±¡IDï¼ˆç¾¤èŠç•™ç©ºï¼‰">
            <input type="text" id="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()">å‘é€</button>
        </div>
        
        <div style="margin-top: 20px; padding: 10px; background-color: #e9ecef; border-radius: 5px;">
            <h4>ä½¿ç”¨è¯´æ˜ï¼š</h4>
            <ul>
                <li>è¾“å…¥å­¦ç”ŸIDå’Œå§“åï¼Œç‚¹å‡»"è¿æ¥"å»ºç«‹WebSocketè¿æ¥</li>
                <li>ç§èŠï¼šåœ¨"ç§èŠå¯¹è±¡ID"ä¸­è¾“å…¥ç›®æ ‡å­¦ç”ŸIDï¼Œå‘é€æ¶ˆæ¯</li>
                <li>ç¾¤èŠï¼šå…ˆåŠ å…¥ç¾¤ç»„ï¼Œç„¶åæ¸…ç©º"ç§èŠå¯¹è±¡ID"å‘é€æ¶ˆæ¯</li>
                <li>å¯ä»¥æ‰“å¼€å¤šä¸ªé¡µé¢ï¼Œç”¨ä¸åŒå­¦ç”ŸIDæµ‹è¯•èŠå¤©åŠŸèƒ½</li>
            </ul>
        </div>
    </div>

    <script>
        class SimpleChat {
            constructor() {
                this.ws = null;
                this.studentId = null;
                this.studentName = null;
            }
            
            connect(studentId, studentName) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.disconnect();
                }
                
                this.studentId = studentId;
                this.studentName = studentName;
                
                this.ws = new WebSocket(`ws://localhost:8080/ws/chat?studentId=${studentId}`);
                
                this.ws.onopen = () => {
                    console.log('WebSocketè¿æ¥æˆåŠŸ');
                    this.updateStatus('å·²è¿æ¥', true);
                    // å‘é€è¿æ¥æ¶ˆæ¯
                    this.send({
                        type: 'CONNECT',
                        studentId: this.studentId,
                        studentName: this.studentName
                    });
                };
                
                this.ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    this.handleMessage(message);
                };
                
                this.ws.onclose = () => {
                    console.log('WebSocketè¿æ¥æ–­å¼€');
                    this.updateStatus('è¿æ¥æ–­å¼€', false);
                };
                
                this.ws.onerror = (error) => {
                    console.error('WebSocketé”™è¯¯:', error);
                    this.updateStatus('è¿æ¥é”™è¯¯', false);
                };
            }
            
            disconnect() {
                if (this.ws) {
                    this.ws.close();
                    this.ws = null;
                }
                this.updateStatus('æœªè¿æ¥', false);
            }
            
            // å‘é€ç§èŠæ¶ˆæ¯
            sendPrivateMessage(targetStudentId, content) {
                this.send({
                    type: 'PRIVATE_MESSAGE',
                    targetStudentId: targetStudentId,
                    content: content,
                    senderId: this.studentId,
                    senderName: this.studentName
                });
            }
            
            // å‘é€ç¾¤èŠæ¶ˆæ¯
            sendGroupMessage(groupId, content) {
                this.send({
                    type: 'GROUP_MESSAGE',
                    groupId: groupId,
                    content: content,
                    senderId: this.studentId,
                    senderName: this.studentName
                });
            }
            
            // åŠ å…¥ç¾¤èŠ
            joinGroup(groupId) {
                this.send({
                    type: 'JOIN_GROUP',
                    groupId: groupId,
                    studentId: this.studentId
                });
            }
            
            // ç¦»å¼€ç¾¤èŠ
            leaveGroup(groupId) {
                this.send({
                    type: 'LEAVE_GROUP',
                    groupId: groupId,
                    studentId: this.studentId
                });
            }
            
            handleMessage(message) {
                switch (message.type) {
                    case 'CONNECT_SUCCESS':
                        console.log('è¿æ¥ç¡®è®¤:', message);
                        this.displaySystemMessage('è¿æ¥æˆåŠŸ');
                        break;
                    case 'PRIVATE_MESSAGE':
                        console.log('æ”¶åˆ°ç§èŠ:', message);
                        this.displayPrivateMessage(message);
                        break;
                    case 'GROUP_MESSAGE':
                        console.log('æ”¶åˆ°ç¾¤èŠ:', message);
                        this.displayGroupMessage(message);
                        break;
                    case 'JOIN_GROUP_SUCCESS':
                        console.log('æˆåŠŸåŠ å…¥ç¾¤ç»„:', message.groupId);
                        this.displaySystemMessage(`æˆåŠŸåŠ å…¥ç¾¤ç»„: ${message.groupId}`);
                        break;
                    case 'LEAVE_GROUP_SUCCESS':
                        console.log('æˆåŠŸç¦»å¼€ç¾¤ç»„:', message.groupId);
                        this.displaySystemMessage(`æˆåŠŸç¦»å¼€ç¾¤ç»„: ${message.groupId}`);
                        break;
                    case 'ERROR':
                        console.error('æœåŠ¡å™¨é”™è¯¯:', message.message);
                        this.displayErrorMessage('é”™è¯¯: ' + message.message);
                        break;
                    default:
                        console.log('æœªçŸ¥æ¶ˆæ¯ç±»å‹:', message);
                }
            }
            
            displayPrivateMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.innerHTML = `<strong>[ç§èŠ] ${message.senderName}:</strong> ${message.content}`;
                this.appendMessage(messageDiv);
            }
            
            displayGroupMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.innerHTML = `<strong>[ç¾¤èŠ-${message.groupId}] ${message.senderName}:</strong> ${message.content}`;
                this.appendMessage(messageDiv);
            }
            
            displaySystemMessage(content) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.style.backgroundColor = '#d4edda';
                messageDiv.innerHTML = `<strong>[ç³»ç»Ÿ]:</strong> ${content}`;
                this.appendMessage(messageDiv);
            }
            
            displayErrorMessage(content) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.style.backgroundColor = '#f8d7da';
                messageDiv.innerHTML = `<strong>[é”™è¯¯]:</strong> ${content}`;
                this.appendMessage(messageDiv);
            }
            
            appendMessage(messageDiv) {
                const chatMessages = document.getElementById('chat-messages');
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            updateStatus(text, connected) {
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = text;
                statusDiv.className = `status ${connected ? 'connected' : 'disconnected'}`;
            }
            
            send(data) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(data));
                } else {
                    this.displayErrorMessage('WebSocketæœªè¿æ¥');
                }
            }
        }

        // å…¨å±€èŠå¤©å®ä¾‹
        const chat = new SimpleChat();

        // é¡µé¢æ“ä½œå‡½æ•°
        function connect() {
            const studentId = parseInt(document.getElementById('student-id').value);
            const studentName = document.getElementById('student-name').value;
            
            if (!studentId || !studentName) {
                alert('è¯·è¾“å…¥å­¦ç”ŸIDå’Œå§“å');
                return;
            }
            
            chat.connect(studentId, studentName);
        }

        function disconnect() {
            chat.disconnect();
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const targetId = document.getElementById('target-id').value;
            const groupId = document.getElementById('group-id').value;
            
            if (!input.value.trim()) {
                alert('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹');
                return;
            }
            
            if (targetId) {
                // ç§èŠ
                chat.sendPrivateMessage(parseInt(targetId), input.value);
            } else if (groupId) {
                // ç¾¤èŠ
                chat.sendGroupMessage(groupId, input.value);
            } else {
                alert('è¯·æŒ‡å®šç§èŠå¯¹è±¡IDæˆ–ç¡®ä¿å·²åŠ å…¥ç¾¤ç»„');
                return;
            }
            
            input.value = '';
        }

        function joinGroup() {
            const groupId = document.getElementById('group-id').value;
            if (!groupId) {
                alert('è¯·è¾“å…¥ç¾¤ç»„ID');
                return;
            }
            chat.joinGroup(groupId);
        }

        function leaveGroup() {
            const groupId = document.getElementById('group-id').value;
            if (!groupId) {
                alert('è¯·è¾“å…¥ç¾¤ç»„ID');
                return;
            }
            chat.leaveGroup(groupId);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>
</html> 